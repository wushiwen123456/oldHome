(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ShopDetails/informtion/informtion"],{"0239":function(t,e,o){"use strict";var n=o("53d0"),s=o.n(n);s.a},"0d00":function(t,e,o){"use strict";var n,s=function(){var t=this,e=t.$createElement,o=(t._self._c,t.__map(t.messageList.messageList,function(e,o){var n=t.photoList(e.add_time),s=t.photoList(e.add_time);return{$orig:t.__get_orig(e),m0:n,m1:s}}));t.$mp.data=Object.assign({},{$root:{l0:o}})},i=[];o.d(e,"b",function(){return s}),o.d(e,"c",function(){return i}),o.d(e,"a",function(){return n})},2076:function(t,e,o){"use strict";o.r(e);var n=o("c9ad"),s=o.n(n);for(var i in n)"default"!==i&&function(t){o.d(e,t,function(){return n[t]})}(i);e["default"]=s.a},"53d0":function(t,e,o){},bdf3:function(t,e,o){"use strict";o.r(e);var n=o("0d00"),s=o("2076");for(var i in s)"default"!==i&&function(t){o.d(e,t,function(){return s[t]})}(i);o("0239");var a,c=o("f0c5"),r=Object(c["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);e["default"]=r.exports},c9ad:function(t,e,o){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=o("d27c"),i=(o("c940"),o("6eb0")),a={data:function(){return{InputBottom:0,send:"",message:null,shopInfo:null,messageall:[],messageList:[],type:1,typepage:-1,style:{pageHeight:0,contentViewHeight:0,footViewHeight:90,mitemHeight:0},scrollTop:0,isShowScroll:!0,openWebScoket:!0,localAvatar:""}},computed:{photoList:function(){return function(t){var e="",o=new Date(1e3*t),n=(o.getFullYear(),(o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1)+"-"),s=o.getDate(),i=this.padLeftZero(o.getHours())+":",a=this.padLeftZero(o.getMinutes()),c=(new Date).getDate();return e=c==s?i+a:n+s+" "+i+a,e}}},onUnload:function(){this.openWebScoket&&t.closeSocket({success:function(){console.log(n("Socket退出成功"," at pages\\ShopDetails\\informtion\\informtion.vue:91"))}}),this.messageList&&(this.messageList.newMessageNum=0),console.log(n(this.messageall," at pages\\ShopDetails\\informtion\\informtion.vue:100")),t.setStorage({key:"messageall_key",data:this.messageall,success:function(){console.log(n("存储聊天记录成功"," at pages\\ShopDetails\\informtion\\informtion.vue:106"))}}),this.openWebScoket&&t.$off("refreshList")},onLoad:function(e){e.indet?(console.log(n("是从消息列表进来的"," at pages\\ShopDetails\\informtion\\informtion.vue:115")),this.openWebScoket=!1):(console.log(n("不是从消息列表进来的"," at pages\\ShopDetails\\informtion\\informtion.vue:118")),this.openWebScoket=!0);var o=this;o.shopInfo=JSON.parse(e.shopInfo),o.message=this.$store.state.userInfo.userData,o.localAvatar=this.$store.state.userInfo.localAvatar,console.log(n(o.localAvatar," at pages\\ShopDetails\\informtion\\informtion.vue:126")),this.messageall=this.$store.state.userChatMessages,this.messageList=this.messageall.find(function(t){return t.storeId==o.shopInfo.shop_id});var s=t.getSystemInfoSync();o.style.pageHeight=s.windowHeight,o.style.contentViewHeight=s.windowHeight-t.getSystemInfoSync().screenWidth/750*100-50,o.isOpenWebScoket()},onReady:function(){this.scrollToBottom()},methods:{padLeftZero:function(t){return("00"+t).substr(t.toString().length)},sendClick:function(){var t=this,e=this,o=this.send;if(o){this.send="";var n={message:o,uid:e.message.uid,shop_id:e.shopInfo.shop_id},i=(Math.round((new Date).getTime()/1e3).toString(),{msg:o,shop_id:e.shopInfo.shop_id,cate:0});this.$store.commit("dealSocketMessage",{dataList:i,shop_info:e.shopInfo}),(0,s.send_message)(n),e.$nextTick(function(){e.scrollToBottom(),t.messageList||(t.messageList=t.messageall.find(function(t){return t.storeId==e.shopInfo.shop_id})),e.scrollToBottom()})}},scrollToBottom:function(e){var o=this,n=t.createSelectorQuery();n.selectAll(".m-item").boundingClientRect(),n.select("#openHeight").boundingClientRect(),n.exec(function(t){o.style.mitemHeight=0,t[0].forEach(function(t){o.style.mitemHeight=o.style.mitemHeight+t.height+40}),setTimeout(function(){o.style.mitemHeight>o.style.contentViewHeight-100&&(o.scrollTop=o.style.mitemHeight-o.style.contentViewHeight)},100)})},shopClick:function(){t.navigateTo({url:"../StoreDetails/storedetails?id="+this.shopInfo.shop_id})},InputFocus:function(t){var e=this;this.InputBottom=t.detail.height,this.$nextTick(function(){e.scrollToBottom()})},InputBlur:function(t){var e=this;this.InputBottom=0,this.$nextTick(function(){e.scrollToBottom()})},isOpenWebScoket:function(){var e=this;this.openWebScoket&&((0,i.openWebScoket)(),t.onSocketOpen(function(t){console.log(n("WebSocket连接已打开！"," at pages\\ShopDetails\\informtion\\informtion.vue:215"))}),t.onSocketError(function(t){console.log(n("WebSocket连接失败,请检查"," at pages\\ShopDetails\\informtion\\informtion.vue:218"))}),t.onSocketMessage(function(t){e.$store.commit("dealSocketMessage",{res:t,shop_info:e.shopInfo}),e.$nextTick(function(){e.messageList||(e.messageList=e.messageall.find(function(t){return t.storeId==e.shopInfo.shop_id})),console.log(n(e.messageList," at pages\\ShopDetails\\informtion\\informtion.vue:229")),e.scrollToBottom()})}))}}};e.default=a}).call(this,o("6e42")["default"],o("0de9")["default"])},d558:function(t,e,o){"use strict";(function(t){o("dead"),o("921b");n(o("66fd"));var e=n(o("bdf3"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("6e42")["createPage"])}},[["d558","common/runtime","common/vendor"]]]);