(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ShopDetails/informtion/informtion"],{"2a71":function(e,t,o){"use strict";(function(e){o("20d5"),o("921b");n(o("66fd"));var t=n(o("ad60"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("6e42")["createPage"])},"31f6":function(e,t,o){},ad60:function(e,t,o){"use strict";o.r(t);var n=o("c19d"),s=o("e5eb");for(var a in s)"default"!==a&&function(e){o.d(t,e,function(){return s[e]})}(a);o("f83f");var i=o("2877"),l=Object(i["a"])(s["default"],n["a"],n["b"],!1,null,null,null);t["default"]=l.exports},c19d:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=(e._self._c,e.__map(e.messageList,function(t,o){var n=e.photoList(t.add_time),s=e.photoList(t.add_time);return{$orig:e.__get_orig(t),m0:n,m1:s}}));e.$mp.data=Object.assign({},{$root:{l0:o}})},s=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return s})},d46b:function(e,t,o){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=o("49da"),a=(o("df87"),{data:function(){return{InputBottom:0,send:"",message:null,shopInfo:null,messageall:[],messageList:[],type:-1,typepage:-1,style:{pageHeight:0,contentViewHeight:0,footViewHeight:90,mitemHeight:0},scrollTop:0}},computed:{photoList:function(){return function(e){var t="",o=new Date(1e3*e),n=(o.getFullYear(),(o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1)+"-"),s=o.getDate(),a=this.padLeftZero(o.getHours())+":",i=this.padLeftZero(o.getMinutes()),l=(new Date).getDate();return t=l==s?a+i:n+s+" "+a+i,t}}},onBackPress:function(){e.closeSocket()},onLoad:function(t){var o=this;e.getSystemInfoSync();o.shopInfo=JSON.parse(t.shopInfo),console.log(n(o.shopInfo," at pages\\ShopDetails\\informtion\\informtion.vue:88")),o.message=e.getStorageSync("Message_key");var a=e.getStorageSync("messageall_key");if(a){o.messageall=a;for(var i=0;i<a.length;i++){if(a[i].storeId==o.shopInfo.storeId){o.messageList=a[i].messageList,o.type=0,o.typepage=i,console.log(n("存在聊天记录，且下标为"," at pages\\ShopDetails\\informtion\\informtion.vue:99")),console.log(n(o.typepage," at pages\\ShopDetails\\informtion\\informtion.vue:100"));break}console.log(n("缓存内存在聊天记录，但不存在该店铺"," at pages\\ShopDetails\\informtion\\informtion.vue:103")),o.type=1}}else{o.type=1;var l=o.message.uid+"_"+o.shopInfo.storeId;(0,s.get_service_message)({group_id:l}).then(function(t){if(t.length>0){o.messageList=t;var n=[],s={storeId:o.shopInfo.storeId,messageList:t};n.push(s),e.setStorage({key:"messageall_key",data:n}),o.type=0,o.typepage=0}})}e.connectSocket({url:"ws://49.234.24.76:9502"}),e.onSocketOpen(function(e){console.log(n("WebSocket连接已打开！"," at pages\\ShopDetails\\informtion\\informtion.vue:134"))}),e.onSocketMessage(function(t){var a=JSON.parse(t.data);if("init"!=a.type){console.log(n("收到服务器内容："," at pages\\ShopDetails\\informtion\\informtion.vue:147")),console.log(n(a," at pages\\ShopDetails\\informtion\\informtion.vue:148"));var i=Math.round((new Date).getTime()/1e3).toString(),l={cate:1,add_time:i,content:a.msg};o.messageList.push(l),o.messageall[o.typepage].messageList=o.messageList,e.setStorage({key:"messageall_key",data:o.messageall})}else{console.log(n("第一次连接"," at pages\\ShopDetails\\informtion\\informtion.vue:139"));var r={client_id:a.client_id,uid:o.message.uid};(0,s.test)(r)}}),o.scrollToBottom()},methods:{padLeftZero:function(e){return("00"+e).substr(e.toString().length)},sendClick:function(){var t=this;if(t.send){var o={message:t.send,uid:t.message.uid,shop_id:t.shopInfo.storeId},a=Math.round((new Date).getTime()/1e3).toString(),i={cate:0,add_time:a,content:t.send};if(t.messageList.push(i),0==t.type)console.log(n("存在店铺"," at pages\\ShopDetails\\informtion\\informtion.vue:190")),t.messageall[t.typepage].messageList=t.messageList;else{var l={storeId:t.shopInfo.storeId,messageList:[i]};t.messageall.push(l),console.log(n(t.messageall," at pages\\ShopDetails\\informtion\\informtion.vue:199")),t.type=0,t.typepage=t.messageall.length-1,console.log(n("不存在店铺，已添加到缓存位置为："," at pages\\ShopDetails\\informtion\\informtion.vue:202")),console.log(n(t.typepage," at pages\\ShopDetails\\informtion\\informtion.vue:203"))}e.setStorage({key:"messageall_key",data:t.messageall}),(0,s.send_message)(o).then(function(e){t.send=""})}},scrollToBottom:function(){var t=this;setTimeout(function(){var o=e.createSelectorQuery();o.select("#openHeight").boundingClientRect(function(o){console.log(n("节点高度为"+o.height," at pages\\ShopDetails\\informtion\\informtion.vue:219")),t.scrollTop=o.height,e.pageScrollTo({scrollTop:o.height})}).exec()},500)},shopClick:function(){e.navigateTo({url:"../StoreDetails/storedetails?id="+this.shopInfo.storeId})},InputFocus:function(t){this.InputBottom=t.detail.height;var o=this.scrollTop+t.detail.height;e.pageScrollTo({scrollTop:o})},InputBlur:function(e){this.InputBottom=0}}});t.default=a}).call(this,o("6e42")["default"],o("0de9")["default"])},e5eb:function(e,t,o){"use strict";o.r(t);var n=o("d46b"),s=o.n(n);for(var a in n)"default"!==a&&function(e){o.d(t,e,function(){return n[e]})}(a);t["default"]=s.a},f83f:function(e,t,o){"use strict";var n=o("31f6"),s=o.n(n);s.a}},[["2a71","common/runtime","common/vendor"]]]);