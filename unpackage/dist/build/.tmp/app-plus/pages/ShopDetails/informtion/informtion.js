(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ShopDetails/informtion/informtion"],{"0239":function(e,t,o){"use strict";var n=o("aa95"),s=o.n(n);s.a},2076:function(e,t,o){"use strict";o.r(t);var n=o("af93"),s=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,function(){return n[e]})}(i);t["default"]=s.a},"26a33":function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=(e._self._c,e.__map(e.messageList,function(t,o){var n=e.photoList(t.add_time),s=e.photoList(t.add_time);return{$orig:e.__get_orig(t),m0:n,m1:s}}));e.$mp.data=Object.assign({},{$root:{l0:o}})},s=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return s})},aa95:function(e,t,o){},af93:function(e,t,o){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=o("d27c"),i=(o("c940"),{data:function(){return{InputBottom:0,send:"",message:null,shopInfo:null,messageall:[],messageList:[],type:-1,typepage:-1,style:{pageHeight:0,contentViewHeight:0,footViewHeight:90,mitemHeight:0},scrollTop:0,scrollHeight:600,isShowScroll:!0}},computed:{photoList:function(){return function(e){var t="",o=new Date(1e3*e),n=(o.getFullYear(),(o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1)+"-"),s=o.getDate(),i=this.padLeftZero(o.getHours())+":",a=this.padLeftZero(o.getMinutes()),l=(new Date).getDate();return t=l==s?i+a:n+s+" "+i+a,t}}},onBackPress:function(){e.closeSocket()},onLoad:function(t){this.getScrollHeight();var o=this;console.log(n(t," at pages\\ShopDetails\\informtion\\informtion.vue:90")),o.shopInfo=JSON.parse(t.shopInfo),console.log(n(o.shopInfo," at pages\\ShopDetails\\informtion\\informtion.vue:93")),o.message=e.getStorageSync("Message_key");var i=e.getStorageSync("messageall_key");if(i){o.messageall=i;for(var a=0;a<i.length;a++){if(i[a].storeId==o.shopInfo.storeId){o.messageList=i[a].messageList,o.type=0,o.typepage=a,console.log(n("存在聊天记录，且下标为"," at pages\\ShopDetails\\informtion\\informtion.vue:104")),console.log(n(o.typepage," at pages\\ShopDetails\\informtion\\informtion.vue:105"));break}console.log(n("缓存内存在聊天记录，但不存在该店铺"," at pages\\ShopDetails\\informtion\\informtion.vue:108")),o.type=1}}else{o.type=1;var l=o.message.uid+"_"+o.shopInfo.storeId;(0,s.get_service_message)({group_id:l}).then(function(t){if(t.length>0){o.messageList=t;var n=[],s={storeId:o.shopInfo.storeId,messageList:t};n.push(s),e.setStorage({key:"messageall_key",data:n}),o.type=0,o.typepage=0}})}e.connectSocket({url:"ws://49.234.24.76:9502"}),e.onSocketOpen(function(e){console.log(n("WebSocket连接已打开！"," at pages\\ShopDetails\\informtion\\informtion.vue:139"))}),e.onSocketMessage(function(t){var i=JSON.parse(t.data);if("init"!=i.type){console.log(n("收到服务器内容："," at pages\\ShopDetails\\informtion\\informtion.vue:152")),console.log(n(i," at pages\\ShopDetails\\informtion\\informtion.vue:153"));var a=Math.round((new Date).getTime()/1e3).toString(),l={cate:1,add_time:a,content:i.msg};o.messageList.push(l),o.messageall[o.typepage].messageList=o.messageList,e.setStorage({key:"messageall_key",data:o.messageall})}else{console.log(n("第一次连接"," at pages\\ShopDetails\\informtion\\informtion.vue:144"));var r={client_id:i.client_id,uid:o.message.uid};(0,s.test)(r)}});var r=e.getSystemInfoSync();o.style.pageHeight=r.windowHeight,o.style.contentViewHeight=r.windowHeight-e.getSystemInfoSync().screenWidth/750*100-50},onReady:function(){this.scrollToBottom()},methods:{getScrollHeight:function(){var t=e.getSystemInfoSync();this.scrollHeight="calc( ".concat(t.windowHeight,"px - ").concat(this.InputBottom,"px )"),console.log(n(this.scrollHeight," at pages\\ShopDetails\\informtion\\informtion.vue:181"))},padLeftZero:function(e){return("00"+e).substr(e.toString().length)},sendClick:function(){var t=this,o=this.send;if(o){this.send="";var i={message:o,uid:t.message.uid,shop_id:t.shopInfo.storeId},a=Math.round((new Date).getTime()/1e3).toString(),l={cate:0,add_time:a,content:o};if(t.messageList.push(l),0==t.type)console.log(n("存在店铺"," at pages\\ShopDetails\\informtion\\informtion.vue:208")),t.messageall[t.typepage].messageList=t.messageList;else{var r={storeId:t.shopInfo.storeId,messageList:[l]};t.messageall.push(r),console.log(n(t.messageall," at pages\\ShopDetails\\informtion\\informtion.vue:217")),t.type=0,t.typepage=t.messageall.length-1,console.log(n("不存在店铺，已添加到缓存位置为："," at pages\\ShopDetails\\informtion\\informtion.vue:220")),console.log(n(t.typepage," at pages\\ShopDetails\\informtion\\informtion.vue:221"))}e.setStorage({key:"messageall_key",data:t.messageall}),(0,s.send_message)(i).then(function(e){}),t.scrollToBottom()}},scrollToBottom:function(t){var o=this,n=e.createSelectorQuery();n.selectAll(".m-item").boundingClientRect(),n.select("#openHeight").boundingClientRect(),n.exec(function(e){o.style.mitemHeight=0,e[0].forEach(function(e){o.style.mitemHeight=o.style.mitemHeight+e.height+40}),setTimeout(function(){o.style.mitemHeight>o.style.contentViewHeight-100&&(o.scrollTop=o.style.mitemHeight-o.style.contentViewHeight)},100)})},shopClick:function(){e.navigateTo({url:"../StoreDetails/storedetails?id="+this.shopInfo.storeId})},InputFocus:function(e){this.InputBottom=e.detail.height,this.scrollToBottom()},InputBlur:function(e){this.InputBottom=0,this.scrollToBottom()}}});t.default=i}).call(this,o("6e42")["default"],o("0de9")["default"])},bdf3:function(e,t,o){"use strict";o.r(t);var n=o("26a33"),s=o("2076");for(var i in s)"default"!==i&&function(e){o.d(t,e,function(){return s[e]})}(i);o("0239");var a=o("2877"),l=Object(a["a"])(s["default"],n["a"],n["b"],!1,null,null,null);t["default"]=l.exports},d558:function(e,t,o){"use strict";(function(e){o("dead"),o("921b");n(o("66fd"));var t=n(o("bdf3"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("6e42")["createPage"])}},[["d558","common/runtime","common/vendor"]]]);