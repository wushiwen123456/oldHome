(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ShopDetails/affirm/affirmOrder"],{5774:function(t,i,e){"use strict";(function(t){e("20d5"),e("921b");n(e("66fd"));var i=n(e("5b8c"));function n(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,e("6e42")["createPage"])},"5b8c":function(t,i,e){"use strict";e.r(i);var n=e("5f0a"),o=e("97f9");for(var r in o)"default"!==r&&function(t){e.d(i,t,function(){return o[t]})}(r);e("6976");var s=e("2877"),a=Object(s["a"])(o["default"],n["a"],n["b"],!1,null,"da7cb7ce",null);i["default"]=a.exports},"5f0a":function(t,i,e){"use strict";var n=function(){var t=this,i=t.$createElement,e=(t._self._c,t.__map(t.cartInfo,function(i,e){var n=t.__map(i.cartInfo,function(i,n){var o=t.dealImg(i.productInfo.image),r=t.productPrice(i,n,e);return{$orig:t.__get_orig(i),m0:o,m1:r}}),o=t.isProduct(i),r=t.disCountTitle(i,e);return{$orig:t.__get_orig(i),l0:n,m2:o,m3:r}}));t.$mp.data=Object.assign({},{$root:{l1:e}})},o=[];e.d(i,"a",function(){return n}),e.d(i,"b",function(){return o})},6976:function(t,i,e){"use strict";var n=e("a047"),o=e.n(n);o.a},"84be":function(t,i,e){"use strict";(function(t,n){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o=e("e443"),r=e("64be"),s=e("0307"),a=e("2f62");function c(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{},n=Object.keys(e);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.forEach(function(i){d(t,i,e[i])})}return t}function d(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}var u=function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"11ec"))},f={components:{uniPopup:u},data:function(){return{shareShow:!1,Noaddress:!1,isCard:!0,discountsType:!1,count:"",cartId:"",token:"",cartInfo:[],address:{},disCountList:[],curDiscountList:[],currentIndex:0,currentIndex2:0,currentPayVal:"",t_price:"",pinkInfo:{},zfb:{}}},onReady:function(){},onshow:function(){this.userAddresss(this.isToken)},onLoad:function(){Object.keys(this.zfb).length&&console.log(t(this.zfb," at pages\\ShopDetails\\affirm\\affirmOrder.vue:176")),this.isToken?this.$store.state.cartId.length?(this.userAddresss(this.isToken),this.cartId=this.$store.state.cartId,this.getAffirmInfo(this.cartId,this.isToken)):n.showToast({title:"未知错误",icon:"none",success:function(){n.switchTab({url:"../../Home/home"})}}):(n.showToast({title:"未知错误",icon:"none"}),n.navigateTo({url:"../../login/login"}))},methods:{radioChange:function(i){this.currentPayVal=i.detail.value,console.log(t(this.currentPayVal," at pages\\ShopDetails\\affirm\\affirmOrder.vue:216"))},productPrice:function(t,i,e){return this.$set(t,"totalPrice",t.productInfo.attrInfo?t.productInfo.attrInfo.price:t.productInfo.price),t.totalPrice},orderMessage:function(){},getCouponOrder:function(){},disCountListCurr:function(){},disCountClick:function(t,i){t.used||this.curDiscountList.forEach(function(t){t.used=!1}),t.used=!t.used,this.discountsType&&(this.discountsType=!this.discountsType),this.currentIndex2=i},userAddresss:function(i){var e=this;(0,r.getAddress)(i).then(function(i){200==i.data.code&&(console.log(t(i," at pages\\ShopDetails\\affirm\\affirmOrder.vue:252")),0==i.data.data.length?n.showModal({title:"您还没有设置默认地址，快去设置吧",cancelColor:"#333333",confirmColor:"#333333",showCancel:!1,confirmText:"立即设置",success:function(t){t.confirm&&n.navigateTo({url:"../../My/address/AllAddress"})}}):(e.Noaddress=!0,e.address=i.data.data,e.$store.commit("setShoppingAddress",e.address)))}).catch(function(i){console.log(t(i," at pages\\ShopDetails\\affirm\\affirmOrder.vue:279"))})},getAffirmInfo:function(t,i){var e=this;(0,o.getAffirmInfo)(t,i).then(function(t){200==t.data.code?(e.cartInfo=t.data.data.cartInfo,e.cartInfo.forEach(function(i,n){e.$set(i,"mark",""),i.usableCoupon.forEach(function(t){e.$set(t,"used",!1)}),e.disCountList.push(i.usableCoupon),e.t_price=t.data.data.price}),e.isPink()):n.switchTab({url:"../../Home/home",success:function(){n.showToast({title:"未知错误"})}})})},isPink:function(){this.pinkInfo=this.$store.state.pinkInfo,!this.comId||this.bargainId||this.seckillId||this.pinkId?this.comId||!this.bargainId||this.seckillId||this.pinkId?this.comId||this.bargainId||!this.seckillId||this.pinkId?this.comId&&!this.bargainId&&!this.seckillId&&this.pinkId&&n.setNavigationBarTitle({title:"参加".concat(this.pinkInfo.nickname,"的团队")}):n.setNavigationBarTitle({title:"秒杀促销"}):n.setNavigationBarTitle({title:"砍价促销"}):n.setNavigationBarTitle({title:"我要开团"})},getDiscountClick:function(){this.discountsType||this.disCountList[this.currentIndex].forEach(function(t){t.used=!1}),this.discountsType=!0},uniPopupClick:function(t,i){if(null==t.usableCoupon)return!1;this.currentIndex=i,this.curDiscountList=this.disCountList[this.currentIndex],this.$refs.shareShow.open()},shareShowclose:function(){this.$refs.shareShow.close()},shippingAddressClick:function(){n.navigateTo({url:"../../My/address/AllAddress"})},addAddressClick:function(){n.navigateTo({url:"../../My/address/addAddress"})},isProduct:function(t){return!!t.usableCoupon.length&&!(this.comId||this.pinkId||this.seckillId||this.bargainId)},submitOrderClick:function(){this.dealData()},dealData:function(){var i=this;if(""==this.currentPayVal)return n.showToast({title:"请选择支付方式",icon:"none"}),!1;var e={},r=this;e.status=this.isCard?"1":"0",e.data=this.cartInfo.map(function(t,e){return{key:t.orderKey,mark:t.mark||"",couponId:i.disCountList[e]&&i.disCountList[e].filter(function(t){return t.used})[0]?i.disCountList[e].filter(function(t){return t.used})[0].cid:"",addressId:r.address.id||"",bargainId:i.bargainId,combinationId:i.comId,seckill_id:i.seckillId,pinkId:i.pinkId}}),n.showModal({title:"确定要提交订单么",content:"请认真核对您的收货地址,确保地址正确",success:function(s){s.confirm&&(0,o.placeOrder)(JSON.stringify(e),i.isToken).then(function(e){if(200==e.data.code)console.log(t(e," at pages\\ShopDetails\\affirm\\affirmOrder.vue:433")),i.goPay(e);else if(400==e.data.code)if(e.data.data.orderId){var o=e.data.data.orderId;n.showModal({title:"请去我的订单中去结算",content:"您的订单已经注册过了，请先去结算",cancelText:"我再想想",confirmText:"现在就去",success:function(t){t.confirm?(r.$store.commit("setOrderKey",o),n.redirectTo({url:"../../My/MyOrder/orderdetail"})):n.navigateBack({})}})}else plus.nativeUI.toast(e.data.msg)})}})},shareFirend:function(){n.showToast({title:"暂未实现",icon:"none"})},IsCard:function(t){this.isCard=t.detail.value},dealImg:function(t){return(0,s.replaceImage)(t)},disCountTitle:function(t,i){return t.usableCoupon.length?this.disCountList[i][this.currentIndex2].used?this.disCountList[i][this.currentIndex2].coupon_title:"不使用优惠券":""},goPay:function(t){this.comId||this.bargainId||this.seckillId||this.pinkId?this.otherPay(t):this.pay(t)},pay:function(t){var i=t.data.data,e=i.unified_order,r=i.price,s=this,a="vx"==this.currentPayVal?"weixin":"alipay";(0,o.payOrders)(e,a,this.isToken).then(function(t){200==t.data.code?"weixin"==a?s.weixinPay(t.data.data,e,r):s.zfbPay(t.data.data,e,r):n.showToast({title:t.data.msg,icon:"none"})})},otherPay:function(t){var i=t.data.data,e=i.unified_order,r=i.price,s=this,a="vx"==this.currentPayVal?"weixin":"alipay";(0,o.payorder)(e,a,this.isToken).then(function(t){200==t.data.code?"weixin"==a?s.weixinPay(t.data.data,e,r):s.zfbPay(t.data.data,e,r):n.showToast({title:t.data.msg,icon:"none"})})},weixinPay:function(t,i,e){var o=this,r=this;n.requestPayment({provider:"wxpay",orderInfo:t,service:3,success:function(t){t.channel.serviceReady?r.comId||r.pinkId?r.doPink(i,e):(o.$store.commit("setOrderKey",i),o.goDetail(e)):n.navigateBack({})}})},zfbPay:function(t,i,e){var o=this,r=this;n.requestPayment({provider:"alipay",orderInfo:t.alipay,service:4,success:function(t){t.channel.serviceReady?r.comId||r.pinkId?r.doPink(i,e):(o.$store.commit("setOrderKey",i),o.goDetail(e)):n.navigateBack({}),o.zfb=t}})},goDetail:function(i){console.log(t(i," at pages\\ShopDetails\\affirm\\affirmOrder.vue:607")),n.redirectTo({url:"success_pay?price=".concat(i)})},doPink:function(t,i){this.$store.commit("setOrderKey",t),n.redirectTo({url:"../../PayOrder/payOrderMessage/payorderMessage?price=".concat(i)})}},computed:c({},(0,a.mapGetters)(["isToken"]),{post:function(){return this.cartInfo.reduce(function(t,i){return 1*t+i.cartInfo.reduce(function(t,i){return 1*(t+i.productInfo.postage)},0)},0).toFixed(2)+"元"},totalPrice:function(){if(this.t_price)return this.disCountList.length?this.disCountList.reduce(function(t,i){return t-i.filter(function(t){return t.used}).reduce(function(t,i){return 1*t+1*i.coupon_price},0)},this.t_price).toFixed(2)+"元":this.t_price.toFixed(2)+"元"},comId:function(){return this.cartInfo[0]&&this.cartInfo[0].cartInfo[0].combination_id?this.cartInfo[0].cartInfo[0].combination_id:""},bargainId:function(){return this.cartInfo[0]&&this.cartInfo[0].cartInfo[0].bargain_id?this.cartInfo[0].cartInfo[0].bargain_id:""},seckillId:function(){return this.cartInfo[0]&&this.cartInfo[0].seckill_id?this.cartInfo[0].seckill_id:""},pinkId:function(){return Object.keys(this.pinkInfo).length?this.pinkInfo.id:""}})};i.default=f}).call(this,e("0de9")["default"],e("6e42")["default"])},"97f9":function(t,i,e){"use strict";e.r(i);var n=e("84be"),o=e.n(n);for(var r in n)"default"!==r&&function(t){e.d(i,t,function(){return n[t]})}(r);i["default"]=o.a},a047:function(t,i,e){}},[["5774","common/runtime","common/vendor"]]]);