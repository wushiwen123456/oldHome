(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ShopDetails/affirm/affirmOrder"],{"1ba6":function(t,i,n){"use strict";var e=n("f0f2"),o=n.n(e);o.a},"2dc3":function(t,i,n){"use strict";var e,o=function(){var t=this,i=t.$createElement,n=(t._self._c,t.__map(t.cartInfo,function(i,n){var e=t.__map(i.cartInfo,function(i,e){var o=t.dealImg(i.productInfo.image),s=t.productPrice(i,e,n);return{$orig:t.__get_orig(i),m0:o,m1:s}}),o=t.isProduct(i),s=t.disCountTitle(i,n);return{$orig:t.__get_orig(i),l0:e,m2:o,m3:s}}));t.$mp.data=Object.assign({},{$root:{l1:n}})},s=[];n.d(i,"b",function(){return o}),n.d(i,"c",function(){return s}),n.d(i,"a",function(){return e})},"74c3":function(t,i,n){"use strict";(function(t,e){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o=n("58c8"),s=n("0ef8"),a=n("6cba"),r=n("2f62");function c(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{},e=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.forEach(function(i){d(t,i,n[i])})}return t}function d(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}var u=function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"ae8a"))},f={components:{uniPopup:u},data:function(){return{show1:!1,shareShow:!1,Noaddress:!1,isCard:!1,discountsType:!1,count:"",cartId:"",token:"",cartInfo:[],address:{},disCountList:[],curDiscountList:[],currentIndex:0,currentIndex2:0,currentPayVal:"",t_price:"",pinkInfo:{},zfb:{},isLoad:!1,switchA:!1}},onReady:function(){this.$refs.loading.open()},onShow:function(){this.isLoad&&this.userAddresss(this.isToken)},onLoad:function(){this.isLoad=!0,Object.keys(this.zfb).length&&console.log(t(this.zfb," at pages\\ShopDetails\\affirm\\affirmOrder.vue:195")),this.isToken?this.$store.state.cartId.length&&(this.userAddresss(this.isToken),this.cartId=this.$store.state.cartId,this.getAffirmInfo(this.cartId,this.isToken)):(e.showToast({title:"未知错误",icon:"none"}),e.navigateTo({url:"../../login/login"}))},methods:{radioChange:function(i){this.currentPayVal=i.detail.value,console.log(t(this.currentPayVal," at pages\\ShopDetails\\affirm\\affirmOrder.vue:227"))},productPrice:function(t,i,n){return this.$set(t,"totalPrice",t.productInfo.attrInfo?t.productInfo.attrInfo.price:t.productInfo.price),t.totalPrice},orderMessage:function(){},getCouponOrder:function(){},disCountListCurr:function(){},disCountClick:function(t,i){t.used||this.curDiscountList.forEach(function(t){t.used=!1}),t.used=!t.used,this.discountsType&&(this.discountsType=!this.discountsType),this.currentIndex2=i},userAddresss:function(i){var n=this;(0,s.getAddress)(i).then(function(i){200==i.data.code&&(console.log(t(i," at pages\\ShopDetails\\affirm\\affirmOrder.vue:263")),0==i.data.data.length?(n.show1=!0,n.Noaddress=!1):(n.Noaddress=!0,n.address=i.data.data,n.$store.commit("setShoppingAddress",n.address)))}).catch(function(i){console.log(t(i," at pages\\ShopDetails\\affirm\\affirmOrder.vue:278"))})},getAffirmInfo:function(t,i){var n=this;(0,o.getAffirmInfo)(t,i).then(function(t){if(n.$refs.loading.close(),200==t.data.code){var i=t.data.data.cartInfo;i.forEach(function(i,e){i.mark="",i.usableCoupon.forEach(function(t){t.used=!1}),n.disCountList.push(i.usableCoupon),n.t_price=t.data.data.price}),n.cartInfo=i,n.isPink()}else e.switchTab({url:"../../Home/home",success:function(){e.showToast({title:"未知错误"})}})})},isPink:function(){this.pinkInfo=this.$store.state.pinkInfo,!this.comId||this.bargainId||this.seckillId||this.pinkId?this.comId||!this.bargainId||this.seckillId||this.pinkId?this.comId||this.bargainId||!this.seckillId||this.pinkId?this.comId&&!this.bargainId&&!this.seckillId&&this.pinkId&&e.setNavigationBarTitle({title:"参加".concat(this.pinkInfo.nickname,"的团队")}):e.setNavigationBarTitle({title:"秒杀促销"}):e.setNavigationBarTitle({title:"砍价促销"}):e.setNavigationBarTitle({title:"我要开团"})},SwitchA:function(t){this.switchA=t.detail.value},getDiscountClick:function(){this.discountsType||this.disCountList[this.currentIndex].forEach(function(t){t.used=!1}),this.discountsType=!0},uniPopupClick:function(t,i){if(null==t.usableCoupon)return!1;this.currentIndex=i,this.curDiscountList=this.disCountList[this.currentIndex],this.$refs.shareShow.open()},shareShowclose:function(){this.$refs.shareShow.close()},shippingAddressClick:function(){e.navigateTo({url:"../../My/address/AllAddress"})},addAddressClick:function(){e.navigateTo({url:"../../My/address/addAddress"})},isProduct:function(t){return!!t.usableCoupon.length&&!(this.comId||this.pinkId||this.seckillId||this.bargainId)},submitOrderClick:function(){this.Noaddress?this.dealData():this.show1=!0},dealData:function(){var i=this;if(""==this.currentPayVal)return e.showToast({title:"请选择支付方式",icon:"none"}),!1;var n={},s=this;n.status=this.switchA?"1":"0",n.data=this.cartInfo.map(function(t,n){return{key:t.orderKey,mark:t.mark||"",couponId:i.disCountList[n]&&i.disCountList[n].filter(function(t){return t.used})[0]?i.disCountList[n].filter(function(t){return t.used})[0].cid:"",addressId:s.address.id||"",bargainId:i.bargainId,combinationId:i.comId,seckill_id:i.seckillId,pinkId:i.pinkId}}),e.showModal({title:"确定要提交订单么",content:"请认真核对您的收货地址,确保地址正确",success:function(a){a.confirm&&(0,o.placeOrder)(JSON.stringify(n),i.isToken).then(function(n){if(200==n.data.code)console.log(t(n," at pages\\ShopDetails\\affirm\\affirmOrder.vue:440")),i.goPay(n);else if(400==n.data.code)if(n.data.data.orderId){var o=n.data.data.orderId;e.showModal({title:"请去我的订单中去结算",content:"您的订单已经注册过了，请先去结算",cancelText:"我再想想",confirmText:"现在就去",success:function(t){t.confirm?(s.$store.commit("setOrderKey",o),e.redirectTo({url:"../../My/MyOrder/orderdetail"})):e.navigateBack({})}})}else plus.nativeUI.toast(n.data.msg)})}})},shareFirend:function(){e.showToast({title:"暂未实现",icon:"none"})},goBack:function(){},setDefaultAddress:function(){e.navigateTo({url:"../../My/address/AllAddress"})},dealImg:function(t){return(0,a.replaceImage)(t)},disCountTitle:function(t,i){return t.usableCoupon.length?this.disCountList[i][this.currentIndex2].used?this.disCountList[i][this.currentIndex2].coupon_title:"不使用优惠券":""},goPay:function(t){this.comId||this.bargainId||this.seckillId||this.pinkId?this.otherPay(t):this.pay(t)},pay:function(t){var i=t.data.data,n=i.unified_order,s=i.price,a=this,r="vx"==this.currentPayVal?"weixin":"alipay";(0,o.payOrders)(n,r,this.isToken).then(function(t){200==t.data.code?"weixin"==r?a.weixinPay(t.data.data,n,s):a.zfbPay(t.data.data,n,s):e.showToast({title:t.data.msg,icon:"none"})})},otherPay:function(t){var i=t.data.data,n=i.unified_order,s=i.price,a=this,r="vx"==this.currentPayVal?"weixin":"alipay";(0,o.payorder)(n,r,this.isToken).then(function(t){200==t.data.code?"weixin"==r?a.weixinPay(t.data.data,n,s):a.zfbPay(t.data.data,n,s):e.showToast({title:t.data.msg,icon:"none"})})},weixinPay:function(t,i,n){var o=this,s=this;e.requestPayment({provider:"wxpay",orderInfo:t,service:3,success:function(t){t.channel.serviceReady?s.comId||s.pinkId?s.doPink(i,n):(o.$store.commit("setOrderKey",i),o.goDetail(n)):e.navigateBack()},fail:function(){e.navigateBack()}})},zfbPay:function(t,i,n){var o=this,s=this;e.requestPayment({provider:"alipay",orderInfo:t.alipay,service:4,success:function(t){t.channel.serviceReady?s.comId||s.pinkId?s.doPink(i,n):(o.$store.commit("setOrderKey",i),o.goDetail(n)):e.navigateBack({}),o.zfb=t},fail:function(){e.navigateBack()}})},goDetail:function(i){console.log(t(i," at pages\\ShopDetails\\affirm\\affirmOrder.vue:622")),e.redirectTo({url:"success_pay?price=".concat(i)})},doPink:function(t,i){this.$store.commit("setOrderKey",t),e.redirectTo({url:"../../PayOrder/payOrderMessage/payorderMessage?price=".concat(i)})}},computed:c({},(0,r.mapGetters)(["isToken"]),{post:function(){return this.cartInfo.reduce(function(t,i){return 1*t+i.cartInfo.reduce(function(t,i){return 1*(t+i.productInfo.postage)},0)},0).toFixed(2)+"元"},totalPrice:function(){if(this.t_price)return this.disCountList.length?this.disCountList.reduce(function(t,i){return t-i.filter(function(t){return t.used}).reduce(function(t,i){return 1*t+1*i.coupon_price},0)},this.t_price).toFixed(2)+"元":this.t_price.toFixed(2)+"元"},comId:function(){return this.cartInfo[0]&&this.cartInfo[0].cartInfo[0].combination_id?this.cartInfo[0].cartInfo[0].combination_id:""},bargainId:function(){return this.cartInfo[0]&&this.cartInfo[0].cartInfo[0].bargain_id?this.cartInfo[0].cartInfo[0].bargain_id:""},seckillId:function(){return this.cartInfo[0]&&this.cartInfo[0].seckill_id?this.cartInfo[0].seckill_id:""},pinkId:function(){return Object.keys(this.pinkInfo).length?this.pinkInfo.id:""},isShowCard:function(){if(this.cartInfo.length)return 1==this.cartInfo.length&&""==this.pinkId&&""==this.comId&&""==this.bargainId&&""==this.seckillId}})};i.default=f}).call(this,n("0de9")["default"],n("6e42")["default"])},"8bf3":function(t,i,n){"use strict";n.r(i);var e=n("74c3"),o=n.n(e);for(var s in e)"default"!==s&&function(t){n.d(i,t,function(){return e[t]})}(s);i["default"]=o.a},"98d2":function(t,i,n){"use strict";(function(t){n("dead"),n("921b");e(n("66fd"));var i=e(n("dfae"));function e(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,n("6e42")["createPage"])},dfae:function(t,i,n){"use strict";n.r(i);var e=n("2dc3"),o=n("8bf3");for(var s in o)"default"!==s&&function(t){n.d(i,t,function(){return o[t]})}(s);n("1ba6");var a,r=n("f0c5"),c=Object(r["a"])(o["default"],e["b"],e["c"],!1,null,"ccef2d44",null,!1,e["a"],a);i["default"]=c.exports},f0f2:function(t,i,n){}},[["98d2","common/runtime","common/vendor"]]]);